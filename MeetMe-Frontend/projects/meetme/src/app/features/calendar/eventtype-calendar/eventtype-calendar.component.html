<div [class.full-width]="selectedDate" class="meetme-card">
  <div class="appointment-page-container">
    <!-- Event Info Section -->
    <section class="appointment-event-info-container">
      <div *ngIf="selectedTimeSlot">
        <button class="primary" (click)="onCancelAppointmentEntry($event)">Back
        </button>
        <hr>
      </div>
      <h2>{{ eventTypeInfo?.name }}</h2>
      <h3>{{ eventTypeOwnerInfo?.userName }}</h3>
      <h4>&#8986;{{ eventTypeInfo?.duration }} minutes</h4>
      <h4 *ngIf="selectedTimeSlot">{{ selectedDateTime }}</h4>
      <h4 *ngIf="selectedTimeSlot">{{ selectedTimeZoneName }}</h4>
    </section>

    <!-- Booking Wrapper -->
    <section class="appointment-calendar-booking-wrapper">
      <!-- Display when selectedTimeSlot is not available -->
      <div [ngStyle]="{'display': !selectedTimeSlot ? 'block' : 'none', 'width': '100%'}">

        <!-- Calendar and Time Slots Section -->

        <div class="calendar-timeslots-wrapper">
          <section class="calendar-section">
            <div style="width:100%; display:flex;justify-content:center;">
              <h3>Select date and time</h3>
            </div>
            <app-calendar style="margin-top: 35px;" (handlerDateClick)="onCalendarDayClicked($event)"
              (handlerMonthChange)="onMonthChange($event)" [allowMultipleSelection]="false"></app-calendar>
            <app-timezone-control style="width: 100%;" #timezoneControl [selectedTimeZone]="selectedTimeZone"
              [showHourFormatChangeOption]="true" (dataLoaded)="onLoadedTimezoneData($event)"
              (selectionChanged)="onChangedTimezone($event)"
              (hourFormatChanged)="onChangedHourFormat($event)"></app-timezone-control>
          </section>
          <section *ngIf="selectedDate" class="timeslots-section">
            <div style="display: flex;justify-content: center;">
              <h3>{{ selectedDate }}</h3>
            </div>
            <div
              style="margin-top:3px; display: flex;flex-direction: row; justify-content: space-evenly;    width: 100%;            gap: 10px;        ">
              <div
                style="display: flex;flex-direction: column;justify-content: center;color: var(--primary-color);flex: 1;align-content: stretch;">
                <span style="display: flex; margin: auto; color: var(--primary-color); text-decoration: underline;font-weight: bold;">AM </span>
              </div>
              <div
                style="display: flex;flex-direction: column;justify-content: center;color: var(--primary-color);flex: 1;align-content: stretch;">
                <span style=" display: flex; margin: auto; color: var(--primary-color); text-decoration:underline;font-weight: bold;">PM </span>
              </div>
            </div>
            <div class="timeslots-wrapper">
              <div class="time-slots">

                <!-- First half of the day time slots -->
                <button class="timeslot-button" (click)="onSelectedTimeSlot(slot)"
                  *ngFor="let slot of selectedDayAvailabilities?.slots! | filter:'isDaySecondHalf':false">
                  {{ slot.startTime }}
                </button>
              </div>
              <div class="time-slots">

                <!-- Second half of the day time slots -->
                <button class="timeslot-button" (click)="onSelectedTimeSlot(slot)"
                  *ngFor="let slot of selectedDayAvailabilities?.slots! | filter:'isDaySecondHalf':true">
                  {{ slot.startTime }}
                </button>
              </div>
            </div>
          </section>
        </div>
      </div>

      <!-- Display when selectedTimeSlot is available -->
      <!-- <div [ngStyle]="{'display': selectedTimeSlot ? 'block' : 'none'}" class="page  page-width-85p"> -->
      <div *ngIf="selectedTimeSlot" class="page  page-width-75p">
        <h2>Invitee details</h2>
        <hr>
        <form [formGroup]="formAppoinmentEntry" class=" ">
          <!-- Form Fields with Labels and Validation Messages -->
          <div class="form-group">
            <label for="inviteeName">Name *</label>
            <div class="form-control">
              <input type="text" autocomplete="off" spellcheck="false" id="inviteeName" formControlName="inviteeName"
                minlength="3" [ngClass]="{ 'is-invalid': submitted && f['inviteeName'].errors }">
              <div *ngIf="submitted && f['inviteeName'].errors" class="invalid-feedback">
                <div *ngIf="f['inviteeName'].errors['required']">Name is required</div>
                <div *ngIf="f['inviteeName'].errors['minlength']">Name should be at least 3 characters long</div>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label for="userName">Email *</label>
            <div class="form-control">
              <input type="text" autocomplete="off" spellcheck="false" id="inviteeEmail" formControlName="inviteeEmail"
                minlength="3" [ngClass]="{ 'is-invalid': submitted && f['inviteeEmail'].errors }">
              <div *ngIf="submitted && f['inviteeEmail'].errors" class="invalid-feedback">
                <div *ngIf="f['inviteeEmail'].errors['required']">Email is required</div>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label for="note">Notes </label>
            <div class="form-control">
              <textarea [ngClass]="{ 'is-invalid': submitted && f['note'].errors }" rows="3" id="note"
                formControlName="note" id="note" name="note"></textarea>
            </div>
          </div>
          <h3 *ngIf="eventTypeQuestions.length>0">Questions :</h3>
          <div formGroupName="questionResponses">
            <ng-container *ngFor="let questionItem of eventTypeQuestions;let i=index;">
              <ng-container [ngSwitch]="true">
                <ng-container *ngSwitchCase="questionItem?.questionType==null"></ng-container>

                <ng-container *ngSwitchCase="questionItem?.questionType==='Text'">
                  <div class="form-group">
                    <label for="{{questionItem.id}}">{{questionItem?.name}} <span
                        *ngIf="questionItem.requiredYN">*</span>
                    </label>
                    <div class="form-control">
                      <input id="{{questionItem.id}}" type="text" autocomplete="off" spellcheck="false"
                        (input)="onAnswerSelectionChnaged($event)" formControlName="{{questionItem.id}}"
                        [ngClass]="{ 'is-invalid': submitted && dynamicFields[questionItem.id!].errors }">
                      <div *ngIf="submitted && dynamicFields[questionItem.id!].errors" class="invalid-feedback">
                        <div *ngIf="dynamicFields[questionItem.id!].errors!['required']">This is required field.</div>
                      </div>
                    </div>
                  </div>
                </ng-container>
                <ng-container *ngSwitchCase="questionItem?.questionType==='MultilineText'">
                  <div class="form-group">
                    <label for="{{questionItem.id}}">{{questionItem?.name}} <span
                        *ngIf="questionItem.requiredYN">*</span>
                    </label>
                    <div class="form-control">
                      <textarea id="{{questionItem.id}}"
                        [ngClass]="{ 'invalid-feedback': submitted && dynamicFields[questionItem.id!] }" rows="3"
                        formControlName="{{questionItem.id}}"></textarea>
                    </div>
                  </div>
                </ng-container>

                <ng-container *ngSwitchCase="questionItem?.questionType==='ComboBox'">
                  <div class="form-group">
                    <label for="{{questionItem.id}}">{{questionItem?.name}} <span
                        *ngIf="questionItem.requiredYN">*</span></label>
                    <div class="form-control">
                      <select id="{{questionItem.id}}" formControlName="{{questionItem.id}}"
                        (change)="onAnswerSelectionChnaged($event)"
                        [ngClass]="{ 'is-invalid': submitted && dynamicFields[questionItem.id!].errors }">
                        <option value="">Select</option>
                        <option [value]="optionItem" *ngFor="let optionItem of questionItem.options.split(',')">
                          {{optionItem}}</option>
                      </select>
                      <div *ngIf="submitted && dynamicFields[questionItem.id!].errors" class="invalid-feedback">
                        <div *ngIf="dynamicFields[questionItem.id!].errors!['required']">This is required field</div>
                      </div>
                    </div>
                  </div>
                </ng-container>
                <ng-container *ngSwitchCase="questionItem?.questionType==='CheckBoxes'">
                  <div class="form-group">
                    <label for="{{questionItem.id}}">{{questionItem?.name}} <span
                        *ngIf="questionItem.requiredYN">*</span></label>
                    <div class="form-control-checkbox-container">
                      <div class="form-control-checkbox-container-item"
                        *ngFor="let optionItem of questionItem.options.split(',')">

                        <input id="{{questionItem.id}}-{{optionItem}}" (change)="onAnswerSelectionChnaged($event,true)"
                          type="checkbox" [value]="optionItem">
                        <label for="{{questionItem.id}}-{{optionItem}}">
                          {{optionItem}}
                        </label>
                      </div>
                      <div *ngIf="submitted && dynamicFields[questionItem.id!].errors" class="invalid-feedback">
                        <div *ngIf="dynamicFields[questionItem.id!].errors!['required']">This is required field</div>
                      </div>
                    </div>
                  </div>
                </ng-container>
                <ng-container *ngSwitchCase="questionItem?.questionType==='RadioButtons'">
                  <div class="form-group">
                    <label for="{{questionItem.id}}">{{questionItem?.name}} <span
                        *ngIf="questionItem.requiredYN">*</span></label>
                    <div class="form-control-checkbox-container">
                      <div class="form-control-checkbox-container-item"
                        *ngFor="let optionItem of questionItem.options.split(',')">
                        <input type="radio" (change)="onAnswerSelectionChnaged($event)" [value]="optionItem"
                          id="{{questionItem.id}}-{{optionItem}}">
                        <label for="{{questionItem.id}}-{{optionItem}}">
                          {{optionItem}}
                        </label>

                      </div>
                      <div class="form-control-checkbox-container-item">
                        <input type="radio" [value]="questionItem.id" [name]="questionItem.name">
                        <label for="{{questionItem.id}}-other">
                          Other
                        </label>
                        <input style="height: 30px;" type="text" id="{{questionItem.id}}-other">
                      </div>

                      <div *ngIf="submitted && dynamicFields[questionItem.id!].errors" class="invalid-feedback">
                        <div *ngIf="dynamicFields[questionItem.id!].errors!['required']">This is required field</div>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </ng-container>
            </ng-container>
          </div>


          <!-- Form Submission Buttons -->
          <hr>
          <div class="action-buttons-container center">
            <!-- <button (click)="onCancelAppointmentEntry($event)" class="btn btn-default">
              Back
            </button> -->
            <button loading-indicator [loading]="isSubmitting" [disabled]="isSubmitting"
              (click)="onSubmitAppointmentForm()" class="primary">
              Booking an Appointment
            </button>
          </div>
        </form>
      </div>
    </section>
  </div>
</div>