<h1>Appointment List</h1>
<div class="data-filter-wrapper">
  <div class="data-searchby-wrapper">
    <div class="data-searchby-time-items">
      <button (click)="onFilterDateOptionClick('upcoming')">Upcoming</button>
      <button (click)="onFilterDateOptionClick('past')">Past</button>
      <button #toggleButtonDateRangeSelectionWindow (click)="onFilterByDateRangeClick()">Date Range</button>
    </div>
    <div class="data-toolbar-items">
      <button>Export</button>
      <button (click)="onToggleFilterMenu()">Filter</button>
    </div>

  </div>
  <div #dateRangeSelectionWindow [style.display]="showDateSelectionWidget?'block':'none'"  class=" date-range-selection-wrapper">
    <div class="">
      <div class="date-range-calendar-wrapper">
        <!-- <app-calendar #calender1 [selectedDates]="selectedDateOfCalendar1" [allowToggleDateSelection]="false"
          (handlerDateClick)="handleCalendar1Click($event)">
          </app-calendar>
       
       <app-calendar #calender2 [selectedDates]=" selectedDateOfCalendar2" [allowToggleDateSelection]="false"
          (handlerDateClick)="handleCalendar2Click($event)">
          </app-calendar> -->
        <app-multi-calendar #multiCalendar [date1]="dateRange1" [date2]="dateRange2"
          (SelectedDatesChanged)="onDateRangeChanged($event)"></app-multi-calendar>
      </div>
      <div>
        <button (click)=" onCancelDateRangeFilter()">Cancel</button>
        <button [disabled]="!isValidDateRange" (click)="onApplyDateRangeFilter()">Apply</button>
      </div>
    </div>
  </div>
  <div *ngIf="showFilterMenu" class="data-filterby-items">
    <div class="data-filterby-item">
      <label class="field-label">Event Type</label>
      <span #toggleButtonEventTypesFilterWindow class="overly-opener" (click)="onToggleEventTypesFilterWindow($event)">
        {{filterByEventTypeText}}
      </span>
      <div *ngIf="filterByEventTypeYN" class="overlay">
        <div #eventTypesFilterWindow class="overlay-content">
          <form [formGroup]="entityTypesFilterForm">
            <div *ngFor="let entityTypeControl of entityTypeListControls; let i = index;"
              formArrayName="entityTypesList">
              <div [formGroupName]="i">
                <input type="checkbox" formControlName="isSelected">
                {{ entityTypeControl.get('entityText')?.value }}
              </div>
            </div>
            <div class="actions">
              <button (click)="onEventTypeCancelFilter()">Cancel </button>
              <button (click)="onEventTypeApplyFilter()">Apply</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div class="data-filterby-item">
      <label class="field-label">Status</label>
      <span #toggleButtonAppointmentStatusByFilterWindow class="overly-opener"
        (click)="onToggleAppointmentStatusFilterWindow($event)">
        {{filterByStatusText}}
      </span>
      <div *ngIf="filterByAppointmentStatusYN" class="overlay">
        <div #appointmentStatusByFilterWindow class="overlay-content">
          <form [formGroup]="statusListFilterForm">
            <div *ngFor="let statusControl of statusListControls; let i = index" formArrayName="statusList">
              <div [formGroupName]="i">
                <input type="checkbox" formControlName="isSelected">
                {{ statusControl.get('statusText')?.value }}
              </div>
            </div>
            <div class="actions">
              <button (click)="onCancelStatusFilter()">Cancel </button>
              <button (click)="onApplyStatusFilter()">Apply</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div class="data-filterby-item">
      <span>Invitee Emails</span>
    </div>
    <div class="data-filterby-item">
      <button (click)="onClearFilter()">Clear Filters</button>
    </div>
  </div>
</div>
<div *ngIf="appointmentsPaginationResult" class="pagination-container">
  <div class="page-links">
    <button (click)="onPagerLinkClick(1)"
      [disabled]="appointmentsPaginationResult.paginationInfo.isFirstPage">First</button>
    <button (click)="onPagerLinkClick(appointmentsPaginationResult.paginationInfo.pageNumber-1)"
      [disabled]="appointmentsPaginationResult.paginationInfo.isFirstPage">Previous</button>
    <button *ngFor="let pageLink of appointmentsPaginationResult.paginationInfo.pagerLinks;let i = index;"
      (click)="onPagerLinkClick(pageLink)">{{pageLink}}</button>
    <button (click)="onPagerLinkClick(appointmentsPaginationResult.paginationInfo.pageNumber+1)"
      [disabled]="appointmentsPaginationResult.paginationInfo.isLastPage">Next</button>
    <button (click)="onPagerLinkClick(appointmentsPaginationResult.paginationInfo.totalPages)"
      [disabled]="appointmentsPaginationResult.paginationInfo.isLastPage">Last</button>
  </div>
  <div class="page-info">
    {{appointmentsPaginationResult.paginationInfo.currentPageDataRangeText}}
  </div>
</div>
<ng-container *ngFor="let appointmentsByDate of appointmentsPaginationResult?.result; let i = index;">
  <div>
    <h2>{{appointmentsByDate.date}}</h2>
    <ul>
      <li *ngFor="let appointment of appointmentsByDate.appointments; let i = index;">
        <div class="appointment-header" (click)="onToggleAppointmentDetails(appointment)">
          <span class="date-time">{{appointment.appointmentDateTime}}</span>
          <span class="event-type">{{appointment.eventTypeTitle}}</span>
          <span class="invitee-name">{{appointment.inviteeName}}</span>
          <span class="invitee-name">{{appointment.status}}</span>
          <span class="toggle-icon"
            [ngClass]="{'expanded': appointment.isExpanded, 'collapsed': !appointment.isExpanded}">+</span>
        </div>
        <div class="appointment-details"
          [ngClass]="{'expanded': appointment.isExpanded,'collapsed': !appointment.isExpanded}">
          <label>Cancellation Reason</label>
          <textarea [(ngModel)]="appointment.cancellationReason" placeholder="Reason"></textarea>
          <div class="actions">
            <button *ngIf="appointment.status==='active'" class="cancel-button"
              (click)="onCancelAppointment(appointment)">Cancel</button>
            <button *ngIf="appointment.status==='active'" class="reschedule-button"
              (click)="onRescheduleAppointment(appointment.id)">Reschedule</button>
          </div>
        </div>
      </li>
    </ul>
  </div>
</ng-container>